<div title="业绩分析" class="easyui-panel">
    <div fit="true">
        <div data-options="region:'north',split:false" style="height: 30px;padding:6px;" border="false">
        <!--高级查询部分-->
        <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
                {%if query_type == 'time'%}
                    <th>时间:</th>
                    <td><input class="easyui-datebox" type="text"/></td>
                {% elif query_type == 'day' %}
                    <th>年份:</th>
                    <td>
                        <select class="easyui-combobox">
                            <option selected="selected" value=''>--请选择--</option>
                        </select>
                    </td>
                    <th>月份:</th>
                    <td>
                        <select class="easyui-combobox">
                            <option selected="selected" value=''>--请选择--</option>
                        </select>
                    </td>
                {% else %}
                    <th>年份:</th>
                    <td>
                        <select class="easyui-combobox">
                            <option selected="selected" value=''>--请选择--</option>
                        </select>
                    </td>
                {% endif %}

                <th>通道:</th>
                <td>
                    <select id="channel_id" class="easyui-combobox">
                        <option selected="selected" value=''>--请选择--</option>
                        {%for channel in channels%}
                        <option value="{{channel.id}}">{{channel.cha_name}}</option>
                        {%endfor%}
                    </select>
                </td>
                <th>合作方:</th>
                <td>
                    <select id="sp_id" class="easyui-combobox">
                        <option selected="selected" value=''>--请选择--</option>
                        {% for sp_info in sp_info_list %}
                        <option value="{{sp_info.id}}">[{{sp_info.id}}]{{sp_info.name}}</option>
                        {% endfor %}
                    </select>
                </td>
                <th>筛选方式:</th>
                <td>
                    <label for="_radio_search_0"><input type="radio" value="0" id="_radio_search_0"/>时段</label>
                    <label for="_radio_search_1"><input type="radio" value="1" id="_radio_search_1"/>日段</label>
                    <label for="_radio_search_2"><input type="radio" value="2" id="_radio_search_2"/>月段</label>
                </td>
                <td align="right">
                    <a class="easyui-linkbutton" data-options="iconCls:'icon-search'" src="javascript:;" onclick="operator_exploits_manange.queryData()" plain="true">查询</a>
                    <a class="easyui-linkbutton" data-options="iconCls:'icon-remove'" src="javascript:;" onclick="operator_exploits_manange.clearQuery()" plain="true">清空</a>
                </td>
            </tr>
        </table>
        </div>
        <div data-options="region:'center',split:false"  border="false">
             <div id="graphic" class="span8">
                <div id="graphic_main" class="main" style="height:400px"></div>
                <div>
            </div>
        </div>
    </div>
</div>
<script>
// 路径配置
require.config({
    paths:{ 
        'echarts' : 'http://echarts.baidu.com/build/echarts',
        'echarts/chart/bar' : 'http://echarts.baidu.com/build/echarts'
    }
});

// 使用
require(
    [
        'echarts',
        'echarts/chart/bar' // 使用柱状图就加载bar模块，按需加载
    ],
    function(ec) {
        // 基于准备好的dom，初始化echarts图表
        var myChart = ec.init(document.getElementById('graphic_main'));
        option = {
            tooltip : {
                trigger: 'axis'
            },
            legend: {
                data:['邮件营销','联盟广告','直接访问','搜索引擎']
            },
            toolbox: {
                show : true,
                feature : {
                    mark : {show: true},
                    dataView : {show: true, readOnly: false},
                    magicType : {show: true, type: ['line', 'bar', 'stack', 'tiled']},
                    restore : {show: true},
                    saveAsImage : {show: true}
                }
            },
            calculable : true,
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : false,
                    data : ['周一','周二','周三','周四','周五','周六','周日']
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    splitArea : {show : true}
                }
            ],
            series : [
                {
                    name:'邮件营销',
                    type:'line',
                    stack: '总量',
                    symbol: 'none',
                    itemStyle: {
                        normal: {
                            areaStyle: {
                                // 区域图，纵向渐变填充
                                color : (function(){
                                    var zrColor = require('zrender/tool/color');
                                    return zrColor.getLinearGradient(
                                        0, 200, 0, 400,
                                        [[0, 'rgba(255,0,0,0.8)'],[0.8, 'rgba(255,255,255,0.1)']]
                                    )
                                })()
                            }
                        }
                    },
                    data:[
                        120, 132, 301, 134, 
                        {value:90, symbol:'droplet',symbolSize:5},
                        230, 210
                    ]
                },
                {
                    name:'联盟广告',
                    type:'line',
                    stack: '总量',
                    smooth: true,
                    symbol: 'image://../asset/ico/favicon.png',     // 系列级个性化拐点图形
                    symbolSize: 8,
                    data:[
                        120, 82,
                        {
                            value:201,
                            symbol: 'star',  // 数据级个性化拐点图形
                            symbolSize : 15,
                            itemStyle : { normal: {label : {
                                show: true,
                                textStyle : {
                                    fontSize : '20',
                                    fontFamily : '微软雅黑',
                                    fontWeight : 'bold'
                                }
                            }}}
                        },
                        {
                            value:134,
                            symbol: 'none'
                        },
                        190, 
                        {
                            value : 230,
                            symbol: 'emptypin',
                            symbolSize: 8
                        },
                        110
                    ]
                },
                {
                    name:'直接访问',
                    type:'line',
                    stack: '总量',
                    symbol: 'arrow',
                    symbolSize: 6,
                    symbolRotate: -45,
                    itemStyle: {
                        normal: {
                            color: 'red',
                            lineStyle: {        // 系列级个性化折线样式
                                width: 2,
                                type: 'dashed'
                            }
                        },
                        emphasis: {
                            color: 'blue'
                        }
                    },
                    data:[
                        320, 332, '-', 334,
                        {
                            value: 390,
                            symbol: 'star6',
                            symbolSize : 20,
                            symbolRotate : 10,
                            itemStyle: {        // 数据级个性化折线样式
                                normal: {
                                    color: 'yellowgreen'
                                },
                                emphasis: {
                                    color: 'orange',
                                    label : {
                                        show: true,
                                        position: 'inside',
                                        textStyle : {
                                            fontSize : '20'
                                        }
                                    }
                                }
                            }
                        },
                        330, 320
                    ]
                },
                {
                    name:'搜索引擎',
                    type:'line',
                    symbol:'emptyCircle',
                    itemStyle: {
                        normal: {
                            lineStyle: {            // 系列级个性化折线样式，横向渐变描边
                                width: 2,
                                color: (function(){
                                    var zrColor = require('zrender/tool/color');
                                    return zrColor.getLinearGradient(
                                        0, 0, 1000, 0,
                                        [[0, 'rgba(255,0,0,0.8)'],[0.8, 'rgba(255,255,0,0.8)']]
                                    )
                                })(),
                                shadowColor : 'rgba(0,0,0,0.5)',
                                shadowBlur: 10,
                                shadowOffsetX: 8,
                                shadowOffsetY: 8
                            }
                        },
                        emphasis : {
                            label : {show: true}
                        }
                    },
                    data:[
                        620, 732, 791, 
                        {value:734, symbol:'emptyHeart',symbolSize:10},
                        890, 930, 820
                    ]
                }
            ]
        };
        // 为echarts对象加载数据 
        myChart.setOption(option); 
    }
);

var operator_exploits_manange = {
    url: '',
    datagrid: $('#operator_exploits_list_dg'),
    formatStatus: function(val, row) {
        if (val) {
            return '<span class="icon icon-ok">&nbsp;</span>已开通'
        }else {
            return '<lable style="color:red"><span class="icon icon-error">&nbsp;</span>已暂停</label>'
        }
    },
    formatterDate: function(val, row) {
        var date = new Date(val);
        return date.getFullYear() + '年' + (date.getMonth() + 1) + '月' + date.getDate()+'日 '+date.getUTCHours()+':'+date.getUTCMinutes()+':'+date.getSeconds();
    },
    formatCommand: function(val, row) {
        val = parseInt(val);
        switch(val){
            case 0:
                return '模糊';
            case 1:
                return '模糊+精确';
            case 2:
                return '双精确';
        }
    },
    queryData: function() {
        var req_data = {'channel_id': $('#channel_id').combobox('getValue'), 
           'sp_id': $("#sp_id").combobox('getValue'), 
           'product_id': $("#product_id").combobox('getValue'), 
           'operator_id': $("#operator_id").combobox('getValue'),
           'busi_type': $("#busi_type").combobox('getValue'),
           'area': $("#area").combobox('getValue')
        };
        this.datagrid.datagrid('load', req_data)
    },
    clearQuery: function() {

    }
};
</script>
