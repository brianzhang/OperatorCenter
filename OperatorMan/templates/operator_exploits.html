<div title="业绩分析" class="easyui-panel">
    <div fit="true">
        <div data-options="region:'north',split:false" style="height: 30px;padding:6px;" border="false">
        <!--高级查询部分-->
        <table border="0" cellspacing="0" cellpadding="0" width="100%">
            <tr>
                {%if query_type == 'time'%}
                    <th>时间:</th>
                    <td><input class="easyui-datebox" type="text"/></td>
                {% elif query_type == 'day' %}
                    <th>年份:</th>
                    <td>
                        <select class="easyui-combobox">
                            <option selected="selected" value=''>--请选择--</option>
                        </select>
                    </td>
                    <th>月份:</th>
                    <td>
                        <select class="easyui-combobox">
                            <option selected="selected" value=''>--请选择--</option>
                        </select>
                    </td>
                {% else %}
                    <th>年份:</th>
                    <td>
                        <select class="easyui-combobox">
                            <option selected="selected" value=''>--请选择--</option>
                        </select>
                    </td>
                {% endif %}

                <th>通道:</th>
                <td>
                    <select id="channel_id" class="easyui-combobox">
                        <option selected="selected" value=''>--请选择--</option>
                        {%for channel in channels%}
                        <option value="{{channel.id}}">{{channel.cha_name}}</option>
                        {%endfor%}
                    </select>
                </td>
                <th>合作方:</th>
                <td>
                    <select id="sp_id" class="easyui-combobox">
                        <option selected="selected" value=''>--请选择--</option>
                        {% for sp_info in sp_info_list %}
                        <option value="{{sp_info.id}}">[{{sp_info.id}}]{{sp_info.name}}</option>
                        {% endfor %}
                    </select>
                </td>
                <th>筛选方式:</th>
                <td>
                    <label for="_radio_search_0"><input type="radio" value="0" id="_radio_search_0"/>时段</label>
                    <label for="_radio_search_1"><input type="radio" value="1" id="_radio_search_1"/>日段</label>
                    <label for="_radio_search_2"><input type="radio" value="2" id="_radio_search_2"/>月段</label>
                </td>
                <td align="right">
                    <a class="easyui-linkbutton" data-options="iconCls:'icon-search'" src="javascript:;" onclick="operator_exploits_manange.queryData()" plain="true">查询</a>
                    <a class="easyui-linkbutton" data-options="iconCls:'icon-remove'" src="javascript:;" onclick="operator_exploits_manange.clearQuery()" plain="true">清空</a>
                </td>
            </tr>
        </table>
        </div>
        <div data-options="region:'center',split:false"  border="false">
             <div id="graphic" class="span8">
                <div id="graphic_main" class="main" style="height:400px"></div>
                <div>
            </div>
        </div>
    </div>
</div>
<script>
// 路径配置
require.config({
    paths:{
        'echarts' : 'http://echarts.baidu.com/build/echarts',
        'echarts/chart/bar' : 'http://echarts.baidu.com/build/echarts'
    }
});

// 使用
require(
    [
        'echarts',
        'echarts/chart/bar' // 使用柱状图就加载bar模块，按需加载
    ],
    function(ec) {
        // 基于准备好的dom，初始化echarts图表
        var myChart = ec.init(document.getElementById('graphic_main'));
        var option = {
            title : {
                text: '业绩分析',
                subtext: '{{regdate}}'
            },
            tooltip : {
                trigger: 'axis'
            },
            legend: {
                data:['上行','定制','转化率(%)','T-定制', 'T-转化率(%)', '分成比(%)']
            },
            toolbox: {
                show : true,
                feature : {
                    mark : {show: true},
                    dataView : {show: true, readOnly: false},
                    magicType : {show: true, type: ['line', 'bar']},
                    restore : {show: true},
                    saveAsImage : {show: true}
                }
            },
            calculable : true,
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : false,
                    data : ['0-1','1-2','2-3','3-4','4-5','5-6','6-7', '7-8','8-9', '9-10', '10-11', '11-12', '12-13', '13-14', '14-15', '15-16', '16-17', '18-19', '19-20', '20-21', '21-22', '22-23', '23-24']
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    axisLabel : {
                        formatter: '{value} %'
                    }
                }
            ],
            series : [
                {
                    name:'上行',
                    type:'line',
                    data:{{mo_all|safe}},
                    markPoint : {
                        data : [
                            {type : 'max', name: '最大值'},
                            {type : 'min', name: '最小值'}
                        ]
                    },
                    markLine : {
                        data : [
                            {type : 'average', name: '平均值'}
                        ]
                    }
                },
                {
                    name:'定制',
                    type:'line',
                    data:{{mr_all|safe}},
                    markPoint : {
                        data : [
                            {type : 'max', name: '最大值'},
                            {type : 'min', name: '最小值'}
                        ]
                    },
                    markLine : {
                        data : [
                            {type : 'average', name: '平均值'}
                        ]
                    }
                },
                {
                    name:'转化率(%)',
                    type:'line',
                    data:{{mr_cp|safe}},
                    markPoint : {
                        data : [
                            {type : 'max', name: '最大值'},
                            {type : 'min', name: '最小值'}
                        ]
                    },
                    markLine : {
                        data : [
                            {type : 'average', name: '平均值'}
                        ]
                    }
                },
                {
                    name:'T-定制',
                    type:'line',
                    data: {{t_ok|safe}},
                    markPoint : {
                        data : [
                            {type : 'max', name: '最大值'},
                            {type : 'min', name: '最小值'}
                        ]
                    },
                    markLine : {
                        data : [
                            {type : 'average', name: '平均值'}
                        ]
                    }
                },
                {
                    name:'T-转化率(%)',
                    type:'line',
                    data: {{t_mr|safe}},
                    markPoint : {
                        data : [
                            {type : 'max', name: '最大值'},
                            {type : 'min', name: '最小值'}
                        ]
                    },
                    markLine : {
                        data : [
                            {type : 'average', name: '平均值'}
                        ]
                    }
                },
                {
                    name:'分成比(%)',
                    type:'line',
                    data: {{t_zh|safe}},
                    markPoint : {
                        data : [
                            {type : 'max', name: '最大值'},
                            {type : 'min', name: '最小值'}
                        ]
                    },
                    markLine : {
                        data : [
                            {type : 'average', name: '平均值'}
                        ]
                    }
                },
            ]
        };

        // 为echarts对象加载数据
        myChart.setOption(option);
    }
);

var operator_exploits_manange = {
    url: '',
    datagrid: $('#operator_exploits_list_dg'),
    formatStatus: function(val, row) {
        if (val) {
            return '<span class="icon icon-ok">&nbsp;</span>已开通'
        }else {
            return '<lable style="color:red"><span class="icon icon-error">&nbsp;</span>已暂停</label>'
        }
    },
    formatterDate: function(val, row) {
        var date = new Date(val);
        return date.getFullYear() + '年' + (date.getMonth() + 1) + '月' + date.getDate()+'日 '+date.getUTCHours()+':'+date.getUTCMinutes()+':'+date.getSeconds();
    },
    formatCommand: function(val, row) {
        val = parseInt(val);
        switch(val){
            case 0:
                return '模糊';
            case 1:
                return '模糊+精确';
            case 2:
                return '双精确';
        }
    },
    queryData: function() {
        var req_data = {'channel_id': $('#channel_id').combobox('getValue'),
           'sp_id': $("#sp_id").combobox('getValue'),
           'product_id': $("#product_id").combobox('getValue'),
           'operator_id': $("#operator_id").combobox('getValue'),
           'busi_type': $("#busi_type").combobox('getValue'),
           'area': $("#area").combobox('getValue')
        };
        this.datagrid.datagrid('load', req_data)
    },
    clearQuery: function() {

    }
};
</script>
